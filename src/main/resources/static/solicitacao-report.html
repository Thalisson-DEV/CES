<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relatório de Solicitação</title>
    <!-- TailwindCSS e Fontes -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* Estilos base para combinar com a aplicação principal */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #F9FAFB;
            color: #1F2937;
        }
        :root {
            --accent-primary: #0c29de;
            --accent-success: #10b981;
            --accent-danger: #EF4444;
        }
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s;
            cursor: pointer;
        }
        .btn-primary { background-color: var(--accent-primary); color: white; }
        .btn-primary:hover { background-color: #384bca; }
        .btn-success { background-color: var(--accent-success); color: white; }
        .btn-success:hover { background-color: #059669; }
        .btn-danger { background-color: var(--accent-danger); color: white; }
        .btn-danger:hover { background-color: #dc2626; }
        .btn-secondary { background-color: white; color: #1F2937; border: 1px solid #E5E7EB; }
        .btn-secondary:hover { background-color: #f9fafb; }
    </style>
</head>
<body class="p-4 sm:p-8">

<main id="report-container" class="max-w-4xl mx-auto bg-white rounded-xl shadow-lg overflow-hidden hidden">
    <!-- Cabeçalho do Relatório -->
    <header class="bg-gray-800 text-white p-6 flex justify-between items-center">
        <div>
            <h1 class="text-2xl font-bold">Relatório de Solicitação</h1>
            <p id="request-id-header" class="text-gray-300"></p>
        </div>
        <img src="https://placehold.co/40x40/ffffff/111827?text=S" alt="Logo Sipel" class="rounded-lg">
    </header>

    <!-- Detalhes da Solicitação -->
    <section class="p-6 border-b border-gray-200">
        <h2 class="text-lg font-semibold mb-4 text-gray-700">Detalhes Principais</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 text-sm">
            <div>
                <label class="block text-gray-500 font-medium">Equipe</label>
                <p id="detail-equipe" class="font-semibold text-gray-800"></p>
            </div>
            <div>
                <label class="block text-gray-500 font-medium">Solicitante</label>
                <p id="detail-solicitante" class="font-semibold text-gray-800"></p>
            </div>
            <div>
                <label class="block text-gray-500 font-medium">Status</label>
                <p id="detail-status" class="font-semibold text-gray-800"></p>
            </div>
            <div>
                <label class="block text-gray-500 font-medium">Processo</label>
                <p id="detail-processo" class="font-semibold text-gray-800"></p>
            </div>
            <div>
                <label class="block text-gray-500 font-medium">Data de Criação</label>
                <p id="detail-data" class="font-semibold text-gray-800"></p>
            </div>
        </div>
        <div class="mt-6">
            <label class="block text-gray-500 font-medium">Observações</label>
            <p id="detail-observacoes" class="text-gray-800 bg-gray-50 p-3 rounded-md border"></p>
        </div>
    </section>

    <!-- Tabela de Itens -->
    <section class="p-6">
        <h2 class="text-lg font-semibold mb-4 text-gray-700">Itens da Solicitação</h2>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                <tr>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Material</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Código</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qtd. Solicitada</th>
                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Qtd. Atendida</th>
                </tr>
                </thead>
                <tbody id="items-table-body" class="bg-white divide-y divide-gray-200">
                <!-- Linhas da tabela serão inseridas aqui -->
                </tbody>
            </table>
        </div>
        <!-- Paginação dos Itens (se necessário) -->
    </section>

    <!-- Rodapé com Ações -->
    <footer class="p-6 bg-gray-50 border-t border-gray-200 flex justify-end items-center gap-4">
        <button id="btn-edit" class="btn btn-secondary"><i class="ph ph-pencil-simple"></i> Editar</button>
        <button id="btn-reject" class="btn btn-danger"><i class="ph ph-x-circle"></i> Rejeitar</button>
        <button id="btn-confirm" class="btn btn-success"><i class="ph ph-check-circle"></i> Confirmar</button>
    </footer>
</main>

<!-- Estado de Carregamento/Erro -->
<div id="loading-state" class="text-center py-20">
    <p class="text-gray-600">Carregando dados da solicitação...</p>
</div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        const API_BASE_URL = 'http://localhost:8080'; // Configure com sua URL
        const reportContainer = document.getElementById('report-container');
        const loadingState = document.getElementById('loading-state');

        // Pega o ID da solicitação da URL
        const params = new URLSearchParams(window.location.search);
        const requestId = params.get('id');

        if (!requestId) {
            loadingState.innerHTML = `<p class="text-red-600 font-bold">Erro: ID da solicitação não fornecido.</p>`;
            return;
        }

        // Função para buscar os dados da API
        async function fetchRequestDetails() {
            // Assumindo que você tem um token salvo no localStorage para autenticação
            const token = localStorage.getItem('jwt_token');
            if (!token) {
                loadingState.innerHTML = `<p class="text-red-600 font-bold">Erro: Usuário não autenticado.</p>`;
                return;
            }

            try {
                // Endpoint para buscar uma solicitação específica (você precisa criar este endpoint)
                const response = await fetch(`${API_BASE_URL}/api/v1/solicitacoes-comercial/${requestId}`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (!response.ok) {
                    throw new Error(`Falha ao buscar dados: ${response.statusText}`);
                }

                const data = await response.json();
                populateReport(data);

                reportContainer.classList.remove('hidden');
                loadingState.classList.add('hidden');

            } catch (error) {
                console.error('Erro ao buscar detalhes da solicitação:', error);
                loadingState.innerHTML = `<p class="text-red-600 font-bold">Erro ao carregar os dados da solicitação.</p>`;
            }
        }

        // Função para preencher o relatório com os dados
        function populateReport(data) {
            document.title = `Relatório - Solicitação #${data.id}`;
            document.getElementById('request-id-header').textContent = `Solicitação #${data.id}`;
            document.getElementById('detail-equipe').textContent = data.equipe?.nomeEquipe || 'N/A';
            document.getElementById('detail-solicitante').textContent = data.solicitante?.nomeCompleto || 'N/A';
            document.getElementById('detail-status').textContent = data.status?.nomeStatus || 'N/A';
            document.getElementById('detail-processo').textContent = data.processo?.nomeProcesso || 'N/A';
            document.getElementById('detail-data').textContent = new Date(data.dataCriacao).toLocaleString('pt-BR');
            document.getElementById('detail-observacoes').textContent = data.observacoes || 'Nenhuma observação.';

            const itemsTableBody = document.getElementById('items-table-body');
            itemsTableBody.innerHTML = ''; // Limpa a tabela

            // Assumindo que a resposta da API inclui uma lista de 'itens'
            if (data.itens && data.itens.length > 0) {
                data.itens.forEach(item => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">${item.material?.nomeMaterial || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.material?.codigoMaterial || 'N/A'}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.quantidadeSolicitada}</td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">${item.quantidadeAtendida}</td>
                        `;
                    itemsTableBody.appendChild(tr);
                });
            } else {
                const tr = document.createElement('tr');
                tr.innerHTML = `<td colspan="4" class="px-6 py-4 text-center text-sm text-gray-500">Nenhum item nesta solicitação.</td>`;
                itemsTableBody.appendChild(tr);
            }
        }

        // Adiciona eventos aos botões de ação
        document.getElementById('btn-edit').addEventListener('click', () => alert('Funcionalidade de Edição a ser implementada.'));
        document.getElementById('btn-reject').addEventListener('click', () => alert('Funcionalidade de Rejeição a ser implementada.'));
        document.getElementById('btn-confirm').addEventListener('click', () => alert('Funcionalidade de Confirmação a ser implementada.'));

        fetchRequestDetails();
    });
</script>
</body>
</html>
