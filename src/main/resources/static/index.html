<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SPM - Sipel, Produtividade e Materiais</title>
  <link rel="shortcut icon" href="assets/sipel.svg" type="image/x-icon">

  <!-- FONTES E ÍCONES -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://unpkg.com/@phosphor-icons/web"></script>

  <!-- CAMINHO CORRIGIDO PARA O ARQUIVO CSS -->
  <link rel="stylesheet" href="/assets/stylesheets/style.css">
</head>
<body>

<!-- O contêiner principal da aplicação -->
<div id="app">
  <!-- O conteúdo será renderizado aqui pelo app.js -->
</div>

<!-- Contêiner para o painel de cadastro (Drawer) -->
<div id="drawer-container"></div>


<!-- =============================================================== -->
<!-- ======================= TEMPLATES ============================= -->
<!-- =============================================================== -->

<template id="template-main-app">
  <div class="app-container">
    <!-- BARRA LATERAL (SIDEBAR) ATUALIZADA -->
    <nav class="sidebar">
      <a href="#/dashboard" class="sidebar-logo">
        <img src="/assets/sipel.svg" alt="Logo Sipel">
      </a>
      <ul class="sidebar-menu">
        <li data-tooltip="Dashboard">
          <a href="#/dashboard" class="sidebar-link" data-menu="dashboard">
            <!-- Ícone com preenchimento -->
            <i class="ph-fill ph-chart-pie-slice"></i>
          </a>
        </li>
        <li data-tooltip="Cadastros">
          <a href="#/materials" class="sidebar-link" data-menu="cadastros">
            <!-- Ícone com preenchimento -->
            <i class="ph-fill ph-folder-plus"></i>
          </a>
        </li>
        <!-- NOVO MENU COMERCIAL -->
        <li data-tooltip="Comercial">
          <a href="#/commercial/new-request" class="sidebar-link" data-menu="comercial">
            <!-- Ícone de alvo com preenchimento -->
            <i class="ph-fill ph-target"></i>
          </a>
        </li>
        <!-- NOVO MENU TÉCNICO -->
        <li data-tooltip="Técnico">
          <a href="#" class="sidebar-link" data-menu="tecnico">
            <!-- Ícone de raio com preenchimento -->
            <i class="ph-fill ph-lightning"></i>
          </a>
        </li>
      </ul>
      <div class="sidebar-footer">
        <div data-tooltip="Meu Perfil">
          <a href="#" class="sidebar-link" id="btn-user-profile">
            <!-- Ícone com preenchimento -->
            <i class="ph-fill ph-user-circle"></i>
          </a>
        </div>
        <div data-tooltip="Sair">
          <a href="#" class="sidebar-link" id="logoutButton">
            <!-- Ícone com preenchimento -->
            <i class="ph-fill ph-sign-out"></i>
          </a>
        </div>
      </div>
    </nav>

    <!-- PAINEL DO SUBMENU ATUALIZADO -->
    <div class="submenu-panel">
      <div id="submenu-dashboard" class="submenu-content">
        <h3>Dashboard</h3>
        <ul>
          <li><a href="#/dashboard" class="page-link">Visão Geral</a></li>
        </ul>
      </div>
      <div id="submenu-cadastros" class="submenu-content">
        <h3>Cadastros</h3>
        <ul>
          <li><a href="#/materials" class="page-link">Materiais</a></li>
          <li><a href="#/works" class="page-link">Obras</a></li>
          <li><a href="#/teams" class="page-link">Equipes</a></li>
          <li><a href="#/users" class="page-link">Usuários</a></li>
        </ul>
      </div>
      <!-- NOVO SUBMENU COMERCIAL -->
      <div id="submenu-comercial" class="submenu-content">
        <h3>Comercial</h3>
        <ul class="submenu-menu">
          <!-- Item Principal 1: Estoque Operacional -->
          <li>
            <button class="submenu-dropdown-toggle">
              <span>Estoque Operacional</span>
              <i class="ph ph-caret-down"></i>
            </button>
            <ul class="submenu-dropdown-content">
              <li><a href="#/commercial/new-request" class="page-link">Solicitação Operacional</a></li>
              <li><a href="#/commercial/approvals" class="page-link">Triagem de Solicitações</a></li>
              <li><a href="#/commercial/material-tracking" class="page-link">Acompanhamento Final</a></li>
              <li><a href="#/commercial/reports" class="page-link">Saldo</a></li>
            </ul>
          </li>
          <li>
            <button class="submenu-dropdown-toggle">
              <span>Produtividade</span>
              <i class="ph ph-caret-down"></i>
            </button>
            <ul class="submenu-dropdown-content">
              <li><a href="#/commercial/new-note" class="page-link">Lançar Nota de Campo</a></li>
              <li><a href="#/commercial/note-tracking" class="page-link">Consultar Notas</a></li>
              <!-- Adicionar outros links de produtividade aqui -->
            </ul>
          </li>
        </ul>
      </div>
      <!-- NOVO SUBMENU TÉCNICO (EM BRANCO, COMO SOLICITADO) -->
      <div id="submenu-tecnico" class="submenu-content">
        <h3>Técnico</h3>
        <ul>
          <!-- Links para as páginas do fluxo técnico entrarão aqui no futuro -->
        </ul>
      </div>
    </div>
    <!-- CONTEÚDO PRINCIPAL -->
    <main class="main-content">
      <section id="page-content" class="content-area">
        <!-- O conteúdo da página será injetado aqui pelo roteador -->
      </section>
    </main>
  </div>
</template>

<!-- Template da Página de Login -->
<template id="template-login">
  <main class="login-card">
    <img src="assets/sipel.png" alt="Logo da Empresa" class="logo">
    <h1>Acesse a Plataforma</h1>
    <p class="subtitle">Bem-vindo de volta! Insira suas credenciais.</p>
    <form id="loginForm" novalidate>
      <div class="input-group">
        <label for="user">Usuário</label>
        <input type="text" id="user" name="username" required value="admin">
      </div>
      <div class="input-group">
        <label for="senhaHash">Senha</label>
        <input type="password" id="senhaHash" name="senha" required value="password">
      </div>
      <div id="feedback" class="feedback" style="display: none;"></div>
      <button type="submit" class="btn-primary" id="loginButton">Entrar</button>
    </form>
  </main>
</template>

<!-- Template da Página de Dashboard -->
<template id="template-dashboard">
  <div class="page-header">
    <h1>Visão Geral</h1>
    <p>Seja bem-vindo de volta, Usuário.</p>
  </div>
  <div class="kpi-grid">
    <div class="kpi-card"><span>--</span>Solicitações Pendentes</div>
    <div class="kpi-card"><span>--</span>Obras Ativas</div>
    <div class="kpi-card"><span>--</span>Itens em Estoque Baixo</div>
    <div class="kpi-card"><span>--</span>Atendimentos no Mês</div>
  </div>
  <div class="dashboard-grid">
    <div class="quick-links-card">
      <h2>Ações Rápidas</h2>
      <ul>
        <li><a href="#/requests/new"><i class="ph ph-plus-circle"></i> Criar Nova Solicitação</a></li>
        <li><a href="#/materials"><i class="ph ph-magnifying-glass"></i> Buscar um Material</a></li>
        <li><a href="#/works"><i class="ph ph-wrench"></i> Gerenciar Obras</a></li>
      </ul>
    </div>
    <div class="updates-card">
      <h2>Últimas Atualizações</h2>
      <ul>
        <li><strong>Versão 3.1.0 (FEAT)</strong><p>Implementado novo report de solicitações para o comercial.</p></li>
        <li><strong>Versão 3.0.0 (CHORE)</strong><p>Implementada os cadastros principais da aplicação.</p></li>
      </ul>
    </div>
  </div>
</template>

<!-- TEMPLATE DE MATERIAIS ATUALIZADO -->
<template id="template-materials">
  <div class="page-header">
    <div>
      <h1>Cadastro de Materiais</h1>
      <p>Gerencie todos os materiais do seu estoque.</p>
    </div>
    <div class="header-actions">
      <a href="/assets/templates/modelo_materiais.xlsx" download class="btn-secondary">
        <i class="ph ph-download-simple"></i> Baixar Modelo
      </a>
      <button id="btn-importar-materiais" class="btn-secondary">
        <i class="ph ph-upload-simple"></i> Importar
      </button>
      <button id="btn-novo-material" class="btn-primary">
        <i class="ph ph-plus"></i> Novo Material
      </button>
      <input type="file" id="input-arquivo-materiais" accept=".xlsx, .xls" style="display: none;">
    </div>
  </div>

  <!-- NOVA BARRA DE FILTROS -->
  <div class="filter-bar">
    <div class="filter-group">
      <label for="filter-material-tipo">Tipo</label>
      <select id="filter-material-tipo">
        <option value="">Todos</option>
        <option value="SUPR">SUPR</option>
        <option value="MATR">MATR</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="filter-material-avaliacao">Avaliação</label>
      <select id="filter-material-avaliacao">
        <option value="">Todas</option>
        <option value="INVEST">INVEST</option>
        <option value="MANUT">MANUT</option>
        <option value="SUCATA">SUCATA</option>
        <option value="RECUP">RECUP</option>
      </select>
    </div>
    <div class="filter-group">
      <label for="filter-material-centro">Centro</label>
      <select id="filter-material-centro">
        <option value="">Todos</option>
        <option value="610">610</option>
        <option value="670">670</option>
      </select>
    </div>
    <div class="filter-group search">
      <label for="busca-material">Busca por texto</label>
      <div class="search-container">
        <input type="text" id="busca-material" placeholder="Código, nome...">
      </div>
    </div>
  </div>

  <div class="table-container">
    <table class="data-table" id="tabela-materiais">
      <thead>
      <tr>
        <th>Código</th>
        <th>Nome</th>
        <th>Unidade</th>
        <th>Tipo</th>
        <th>Avaliação</th>
        <th>Centro</th>
        <th>Ações</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="empty-state-materiais" class="empty-state"></div>

  <!-- NOVOS CONTROLES DE PAGINAÇÃO -->
  <div class="pagination-controls" id="pagination-materiais"></div>
</template>

<!-- TEMPLATE DE OBRAS ATUALIZADO -->
<template id="template-works">
  <div class="page-header">
    <div>
      <h1>Cadastro de Obras</h1>
      <p>Gerencie os projetos e obras da empresa.</p>
    </div>
    <div class="header-actions">
      <a href="/static/assets/templates/modelo_obras.xlsx" download class="btn-secondary">
        <i class="ph ph-download-simple"></i> Baixar Modelo
      </a>
      <button id="btn-importar-obras" class="btn-secondary">
        <i class="ph ph-upload-simple"></i> Importar
      </button>
      <button id="btn-nova-obra" class="btn-primary">
        <i class="ph ph-plus"></i> Nova Obra
      </button>
      <input type="file" id="input-arquivo-obras" accept=".xlsx, .xls" style="display: none;">
    </div>
  </div>

  <!-- BARRA DE FILTROS ATUALIZADA -->
  <div class="filter-bar">
    <div class="filter-group">
      <label for="filter-obra-status">Status</label>
      <select id="filter-obra-status"></select>
    </div>
    <div class="filter-group">
      <label for="filter-obra-base">Base da Obra</label>
      <select id="filter-obra-base"></select>
    </div>
    <!-- NOVOS FILTROS -->
    <div class="filter-group">
      <label for="filter-obra-coordenador">Coordenador</label>
      <select id="filter-obra-coordenador"></select>
    </div>
    <div class="filter-group">
      <label for="filter-obra-supervisor">Supervisor</label>
      <select id="filter-obra-supervisor"></select>
    </div>
    <div class="filter-group search">
      <label for="busca-obra">Busca por texto</label>
      <div class="search-container">
        <input type="text" id="busca-obra" placeholder="Nº da obra, título...">
      </div>
    </div>
  </div>

  <div class="table-container">
    <table id="tabela-obras" class="data-table">
      <!-- CABEÇALHO DA TABELA CORRIGIDO -->
      <thead>
      <tr>
        <th>Nº da Obra</th>
        <th>Título</th>
        <th>Status</th>
        <th>Base da Obra</th>
        <th>Início</th>
        <th>Coordenador</th>
        <th>Supervisor</th>
        <th>Ações</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="empty-state-obras" class="empty-state"></div>

  <!-- CONTROLES DE PAGINAÇÃO -->
  <div class="pagination-controls" id="pagination-obras"></div>
</template>


<!-- TEMPLATE DE EQUIPES ATUALIZADO -->
<template id="template-teams">
  <div class="page-header">
    <div>
      <h1>Cadastro de Equipes</h1>
      <p>Gerencie as equipes operacionais e suas lideranças.</p>
    </div>
    <div class="header-actions">
      <a href="/assets/templates/modelo_equipes.xlsx" download class="btn-secondary">
        <i class="ph ph-download-simple"></i> Baixar Modelo
      </a>
      <button id="btn-importar-equipes" class="btn-secondary">
        <i class="ph ph-upload-simple"></i> Importar
      </button>
      <button id="btn-nova-equipe" class="btn-primary">
        <i class="ph ph-plus"></i> Nova Equipe
      </button>
      <input type="file" id="input-arquivo-equipes" accept=".xlsx, .xls" style="display: none;">
    </div>
  </div>

  <!-- BARRA DE FILTROS -->
  <div class="filter-bar">
    <div class="filter-group">
      <label for="filter-equipe-base">Base Operacional</label>
      <select id="filter-equipe-base"></select>
    </div>
    <div class="filter-group">
      <label for="filter-equipe-processo">Processo</label>
      <select id="filter-equipe-processo"></select>
    </div>
    <div class="filter-group search">
      <label for="busca-equipe">Busca por texto</label>
      <div class="search-container">
        <input type="text" id="busca-equipe" placeholder="Nome da equipe, vulgo...">
      </div>
    </div>
  </div>

  <div class="table-container">
    <table class="data-table" id="tabela-equipes">
      <thead>
      <tr>
        <th>Nome da Equipe</th>
        <th>Vulgo</th>
        <th>Base</th>
        <th>Processo</th>
        <th>Coordenador</th>
        <th>Supervisor</th>
        <th>Status</th>
        <th>Ações</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="empty-state-equipes" class="empty-state"></div>

  <!-- CONTROLES DE PAGINAÇÃO -->
  <div class="pagination-controls" id="pagination-equipes"></div>
</template>

<!-- TEMPLATE PARA CADASTRO DE USUARIOS -->
<template id="template-users">
  <div class="page-header">
    <div>
      <h1>Gerenciamento de Usuários</h1>
      <p>Adicione e gerencie os usuários do sistema.</p>
    </div>
    <div class="header-actions">
      <button id="btn-novo-usuario" class="btn-primary">
        <i class="ph ph-plus"></i> Novo Usuário
      </button>
    </div>
  </div>

  <!-- BARRA DE FILTROS -->
  <div class="filter-bar">
    <div class="filter-group">
      <label for="filter-user-perfil">Perfil</label>
      <select id="filter-user-perfil"></select>
    </div>
    <div class="filter-group">
      <label for="filter-user-base">Base Operacional</label>
      <select id="filter-user-base"></select>
    </div>
    <div class="filter-group search">
      <label for="busca-usuario">Busca por texto</label>
      <div class="search-container">
        <input type="text" id="busca-usuario" placeholder="Nome, login, email...">
      </div>
    </div>
  </div>

  <div class="table-container">
    <table class="data-table" id="tabela-usuarios">
      <thead>
      <tr>
        <th>Nome Completo</th>
        <th>Login (Usuário)</th>
        <th>Email</th>
        <th>Perfil</th>
        <th>Base</th>
        <th>Status</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="empty-state-usuarios" class="empty-state"></div>

  <!-- CONTROLES DE PAGINAÇÃO -->
  <div class="pagination-controls" id="pagination-usuarios"></div>
</template>

<template id="template-commercial-tracking">
  <div class="page-header">
    <div>
      <h1>Acompanhamento de Solicitações</h1>
      <p>Visualize e gerencie todas as solicitações comerciais.</p>
    </div>
    <div class="header-actions">
      <!-- O botão de "Nova Solicitação" pode ser adicionado aqui ou no menu -->
      <a href="#/commercial/new-request" class="btn-primary">
        <i class="ph ph-plus"></i> Nova Solicitação
      </a>
    </div>
  </div>

  <!-- BARRA DE FILTROS -->
  <div class="filter-bar">
    <div class="filter-group">
      <label for="filter-request-status">Status</label>
      <select id="filter-request-status"></select>
    </div>
    <div class="filter-group">
      <label for="filter-request-equipe">Equipe</label>
      <select id="filter-request-equipe"></select>
    </div>
    <div class="filter-group">
      <label for="filter-request-solicitante">Solicitante</label>
      <select id="filter-request-solicitante"></select>
    </div>
    <div class="filter-group search">
      <label for="busca-request">Busca por texto</label>
      <div class="search-container">
        <input type="text" id="busca-request" placeholder="Observações...">
      </div>
    </div>
  </div>

  <div class="table-container">
    <table class="data-table" id="tabela-solicitacoes">
      <thead>
      <tr>
        <th>ID</th>
        <th>Equipe</th>
        <th>Solicitante</th>
        <th>Processo</th>
        <th>Status</th>
        <th>Data de Criação</th>
        <th>Ações</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="empty-state-solicitacoes" class="empty-state"></div>

  <!-- CONTROLES DE PAGINAÇÃO -->
  <div class="pagination-controls" id="pagination-solicitacoes"></div>
</template>


<template id="template-new-material-request">
  <div class="page-header">
    <div>
      <h1>Nova Solicitação de Materiais</h1>
      <p id="page-subtitle">Passo 1 de 2: Preencha os detalhes da solicitação.</p>
    </div>
  </div>

  <div class="form-container" style="background-color: var(--bg-panel); border: 1px solid var(--border-color); border-radius: 5px; padding: 2rem; box-shadow: var(--shadow-sm);">

    <form id="form-request-header">
      <div class="form-row">
        <div class="form-group">
          <label for="request-equipe">Equipe Responsável*</label>
          <select id="request-equipe" required></select>
        </div>
        <div class="form-group">
          <label for="request-processo">Processo*</label>
          <select id="request-processo" required></select>
        </div>
      </div>
      <div class="form-group">
        <label for="request-observacoes">Observações (opcional)</label>
        <textarea id="request-observacoes" rows="3" placeholder="Qualquer informação adicional..."></textarea>
      </div>

      <div class="form-actions" style="border-top: none; padding-top: 0; margin-top: 0; justify-content: flex-start;">
        <button type="button" id="btn-cancel-header" class="btn-danger">
          <i class="ph ph-x-circle"></i> Cancelar
        </button>
        <button type="button" id="btn-proceed-to-items" class="btn-primary">
          Prosseguir <i class="ph ph-arrow-right"></i>
        </button>
      </div>
    </form>

    <div id="section-request-items" class="hidden">
      <hr style="margin: 2.5rem 0; border-color: var(--border-color);">

      <form id="form-add-item">
        <div class="form-row" style="align-items: flex-end;">
          <div class="form-group" style="flex-grow: 3;">
            <label for="search-material-input">Material*</label>
            <div class="searchable-select-container">
              <input type="text" id="search-material-input" placeholder="Digite para buscar pelo nome ou código..." autocomplete="off" required>
              <div id="material-results-dropdown" class="searchable-results-list"></div>
            </div>
          </div>

          <div class="form-group">
            <label for="item-quantity">Quantidade*</label>
            <input type="number" id="item-quantity" min="0.01" step="any" placeholder="0.00" required>
          </div>

          <div class="form-group">
            <button type="submit" class="btn-primary" style="width: 100%;">
              <i class="ph ph-plus"></i> Adicionar
            </button>
          </div>
        </div>
      </form>

      <h3 style="margin-top: 2rem;">Itens da Solicitação</h3>
      <div class="table-container" style="margin-top: 1rem;">
        <table class="data-table" id="table-added-items">
          <thead>
          <tr>
            <th>Material</th>
            <th>Código</th>
            <th>Quantidade Solicitada</th>
            <th style="width: 80px;">Ações</th>
          </tr>
          </thead>
          <tbody>
          </tbody>
        </table>
      </div>
      <div id="empty-state-items" class="empty-state" style="margin-top:0; border:none; padding: 2rem; display: flex;"></div>

      <div class="form-actions" style="margin-top: 2rem;">
        <button type="button" id="btn-back-to-header" class="btn-secondary">
          <i class="ph ph-arrow-left"></i> Voltar ao Cabeçalho
        </button>
        <button type="button" id="btn-save-request" class="btn-primary">
          <i class="ph ph-check-circle"></i> Salvar Solicitação
        </button>
      </div>
    </div>
  </div>
</template>

<template id="template-commercial-approvals">
  <div class="page-header">
    <div>
      <h1>Aprovação de Solicitações</h1>
      <p>Analise e aprove as novas solicitações enviadas pelas equipes.</p>
    </div>
  </div>

  <!-- BARRA DE FILTROS -->
  <div class="filter-bar">
    <div class="filter-group">
      <label for="filter-approval-equipe">Equipe</label>
      <select id="filter-approval-equipe"></select>
    </div>
    <div class="filter-group">
      <label for="filter-approval-solicitante">Solicitante</label>
      <select id="filter-approval-solicitante"></select>
    </div>
    <div class="filter-group search">
      <label for="busca-approval">Busca por texto</label>
      <div class="search-container">
        <input type="text" id="busca-approval" placeholder="Observações...">
      </div>
    </div>
  </div>

  <div class="table-container">
    <table class="data-table" id="tabela-aprovacoes">
      <thead>
      <tr>
        <th>ID</th>
        <th>Equipe</th>
        <th>Solicitante</th>
        <th>Processo</th>
        <th>Data de Criação</th>
        <th>Ações</th>
      </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="empty-state-aprovacoes" class="empty-state"></div>

  <!-- CONTROLES DE PAGINAÇÃO -->
  <div class="pagination-controls" id="pagination-aprovacoes"></div>
</template>

<template id="template-commercial-request-details">
  <div class="page-header">
    <div>
      <h1 id="details-page-title">Detalhes da Solicitação</h1>
      <p>Visualize os itens e gerencie o estado da solicitação.</p>
    </div>
    <div class="header-actions">
      <a href="#/commercial/material-tracking" class="btn-secondary">
        <i class="ph ph-arrow-left"></i> Voltar para Acompanhamento
      </a>
    </div>
  </div>

  <!-- Card Principal Unificado -->
  <main class="form-container max-w-6xl mx-auto">
    <section class="p-6">
      <div id="details-header-content" class="principal-card">
        <!-- Os detalhes serão preenchidos pelo JS -->
      </div>
    </section>

    <hr style="margin-bottom: 2rem" class="border-gray-200">

    <!-- Seção 2: Itens da Solicitação -->
    <section class="p-6">

      <!-- Tabela de itens -->
      <div class="table-container">
        <table class="data-table" id="tabela-itens-solicitacao">
          <thead>
          <tr>
            <th>Material</th>
            <th>Código</th>
            <th>Status</th>
            <th>Qtd. Solicitada</th>
            <th>Qtd. Atendida</th>
          </tr>
          </thead>
          <tbody id="items-table-body">
          <!-- Itens da solicitação aparecerão aqui -->
          </tbody>
        </table>
      </div>
      <div id="empty-state-details-items" class="empty-state"></div>
      <div class="flex items-center gap-2">
        <button id="btn-edit-items" class="btn-secondary text-sm"><i class="ph ph-pencil-simple"></i> Editar itens</button>
        <button id="btn-atender-tudo" class="btn-primary btn-success text-sm">Confirmar</button>
        <button id="btn-rejeitar-tudo" class="btn-danger btn btn-danger text-sm">Rejeitar</button>
      </div>
    </section>
  </main>
</template>

<template id="template-commercial-approvals-details">
  <div class="page-header">
    <div>
      <h1 id="approval-page-title">Análise da Solicitação</h1>
      <p>Verifique os itens e aprove ou recuse a solicitação.</p>
    </div>
    <div class="header-actions">
      <a href="#/commercial/approvals" class="btn btn-secondary">
        <i class="ph ph-arrow-left"></i> Voltar para Aprovações
      </a>
    </div>
  </div>

  <!-- Card Principal Unificado -->
  <main class="form-container max-w-6xl mx-auto">
    <!-- Seção 1: Detalhes da Solicitação -->
    <section class="p-6">
      <div id="approval-header-content" class="principal-card"></div>
    </section>

    <!-- Seção 2: Itens da Solicitação -->
    <hr style="margin-bottom: 2rem" class="border-gray-200">
    <section class="p-6">

      <!-- Tabela de itens -->
      <div class="table-container">
        <table class="data-table" id="tabela-itens-aprovacao">
          <thead>
          <tr>
            <th>Material</th>
            <th>Código</th>
            <th>Qtd. Solicitada</th>
          </tr>
          </thead>
          <tbody id="approval-items-table-body"></tbody>
        </table>
      </div>
      <div id="empty-state-approval-items" class="empty-state"></div>
      <button id="btn-edit-request" class="btn-secondary text-sm"><i class="ph ph-pencil-simple"></i> Editar itens</button>
      <button id="btn-approve-all" class="btn-primary btn-success text-sm">Confirmar</button>
      <button id="btn-reject-all" class="btn-danger btn btn-danger text-sm">Rejeitar</button>
    </section>
  </main>
</template>


<template id="template-new-field-note">
  <div class="page-header">
    <div>
      <h1>Lançamento de Nota de Campo</h1>
      <p id="note-page-subtitle">Passo 1 de 2: Preencha os detalhes da nota.</p>
    </div>
  </div>

  <main class="form-container max-w-6xl mx-auto">
    <!-- Seção 1: Detalhes da Nota (Cabeçalho) -->
    <section id="note-header-section" class="p-6">
      <form id="form-main-note">
        <div class="form-row">
          <div class="form-group">
            <label for="note-number">Número da Nota*</label>
            <input type="text" id="note-number" required placeholder="Ex: OS12345">
          </div>
          <div class="form-group">
            <label for="note-type">Tipo de Nota*</label>
            <select id="note-type" required></select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="search-equipe-input">Equipe Responsável*</label>
            <div class="searchable-select-container">
              <input type="text" id="search-equipe-input" placeholder="Digite para buscar a equipe..." autocomplete="off" required>
              <div id="equipe-results-dropdown" class="searchable-results-list"></div>
            </div>
          </div>
          <div class="form-group">
            <label for="note-base">Base Operacional*</label>
            <select id="note-base" required></select>
          </div>
        </div>
        <div class="form-group">
          <label for="note-observacoes">Observações</label>
          <textarea id="note-observacoes" rows="3" placeholder="Adicione qualquer detalhe relevante..."></textarea>
        </div>
      </form>
      <div class="form-actions border-t-0 pt-0 mt-6">
        <a href="#/dashboard" class="btn btn-secondary">Cancelar</a>
        <button type="button" id="btn-proceed-to-applications" class="btn btn-primary">
          Prosseguir para Lançamentos <i class="ph ph-arrow-right"></i>
        </button>
      </div>
    </section>

    <!-- Seção 2: Itens e Serviços (Inicialmente Oculta) -->
    <section id="note-items-section" class="p-6 hidden">
      <!-- Sub-seção Materiais -->
      <h2 class="form-section-title mb-6">2. Materiais Aplicados / Retirados</h2>
      <form id="form-add-application" class="mb-8">
        <div class="filter-bar p-0 bg-transparent border-none">
          <div class="filter-group" style="flex-grow: 2;"><label for="app-material-search">Material*</label><div class="searchable-select-container"><input type="text" id="app-material-search" placeholder="Digite para buscar..." autocomplete="off" required><div id="app-material-results" class="searchable-results-list"></div></div></div>
          <div class="filter-group"><label for="app-type">Tipo*</label><select id="app-type" required></select></div>
          <div class="filter-group"><label for="app-quantity">Qtd.*</label><input type="number" id="app-quantity" required min="0.01" step="any" class="text-right" placeholder="0.00"></div>
          <div class="filter-group"><label>&nbsp;</label><button type="submit" class="btn btn-primary w-full"><i class="ph ph-plus"></i> Adicionar</button></div>
        </div>
      </form>
      <div class="table-container"><table class="data-table" id="table-added-applications"><thead><tr><th>Material</th><th>Código</th><th>Tipo</th><th>Quantidade</th><th class="w-16 text-right">Ações</th></tr></thead><tbody></tbody></table></div>
      <div id="empty-state-applications" class="empty-state"></div>
      <hr class="my-8">
      <!-- Sub-seção Serviços -->
      <h2 class="form-section-title mb-6">3. Serviços Executados</h2>
      <form id="form-add-service" class="mb-8">
        <div class="filter-bar p-0 bg-transparent border-none">
          <div class="filter-group" style="flex-grow: 3;"><label for="app-service-search">Serviço*</label><div class="searchable-select-container"><input type="text" id="app-service-search" placeholder="Digite para buscar o serviço..." autocomplete="off" required><div id="app-service-results" class="searchable-results-list"></div></div></div>
          <div class="filter-group"><label>&nbsp;</label><button type="submit" class="btn btn-primary w-full"><i class="ph ph-plus"></i> Adicionar Serviço</button></div>
        </div>
      </form>
      <div class="table-container"><table class="data-table" id="table-added-services"><thead><tr><th>Serviço</th><th>Código</th><th class="w-16 text-right">Ações</th></tr></thead><tbody></tbody></table></div>
      <div id="empty-state-services" class="empty-state"></div>
      <!-- Ações Finais -->
      <div class="form-actions mt-8">
        <button type="button" id="btn-back-to-note-header" class="btn btn-secondary"><i class="ph ph-arrow-left"></i> Voltar</button>
        <button type="button" id="btn-save-note" class="btn btn-primary"><i class="ph ph-check-circle"></i> Finalizar Lançamento</button>
      </div>
    </section>
  </main>
</template>

<!-- Template para a Nova Página: Consultar Notas -->
<template id="template-note-tracking">
  <div class="page-header">
    <div>
      <h1>Consultar Notas de Campo</h1>
      <p>Visualize e filtre todas as notas de campo lançadas.</p>
    </div>
    <div class="header-actions">
      <a href="#/technical/new-note" class="btn-primary">
        <i class="ph ph-plus"></i> Lançar Nova Nota
      </a>
    </div>
  </div>
  <div class="filter-bar">
    <div class="filter-group"><label for="filter-note-type">Tipo de Nota</label><select id="filter-note-type"></select></div>
    <div class="filter-group"><label for="filter-note-equipe">Equipe</label><select id="filter-note-equipe"></select></div>
    <div class="filter-group"><label for="filter-note-base">Base</label><select id="filter-note-base"></select></div>
    <div class="filter-group search"><label for="busca-note">Busca</label><div class="search-container"><input type="text" id="busca-note" placeholder="Número da nota, observações..."></div></div>
  </div>
  <div class="table-container">
    <table class="data-table" id="tabela-notas">
      <thead><tr><th>Nº da Nota</th><th>Tipo</th><th>Equipe</th><th>Base</th><th>Usuário</th><th>Data</th><th>Ações</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>
  <div id="empty-state-notas" class="empty-state"></div>
  <div class="pagination-controls" id="pagination-notas"></div>
</template>

<!-- NOVO TEMPLATE PARA O PAINEL DE CADASTRO (DRAWER) -->
<template id="template-drawer">
  <div class="drawer-overlay"></div>
  <div class="drawer-panel">
    <div class="drawer-header">
      <h2 id="drawer-title"></h2>
      <button class="btn-icon" id="btn-close-drawer">&times;</button>
    </div>
    <div class="drawer-body" id="drawer-body">
      <!-- O formulário será injetado aqui -->
    </div>
    <div class="drawer-footer">
      <button class="btn-secondary" id="btn-cancel-drawer">Cancelar</button>
      <button class="btn-primary text-sm" id="btn-save-drawer">Salvar</button>
    </div>
  </div>
</template>

<!-- =============================================================== -->
<!-- ========================= MODAIS ============================== -->
<!-- =============================================================== -->

<!-- Contêiner para MODAL DE NOTIFICAÇÃO (Toast) -->
<div id="notification-toast-container" class="toast-container"></div>

<!-- MODAL DE PERFIL DO USUÁRIO -->
<div id="user-profile-modal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h2>Meu Perfil</h2>
      <button class="btn-icon btn-close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <form id="profile-form">
        <div class="form-group">
          <label for="profile-name">Nome</label>
          <input type="text" id="profile-name" value="SPL666599" required>
        </div>
        <div class="form-group">
          <label for="profile-email">Email</label>
          <input type="email" id="profile-email" value="controledesempenho@sipel.com.br" required>
        </div>
        <hr class="form-divider">
        <br>
        <div class="form-group">
          <label for="profile-new-password">Nova Senha</label>
          <input type="password" id="profile-new-password" placeholder="Digite sua nova senha">
        </div>
      </form>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn-secondary btn-close-modal text-sm">Cancelar</button>
      <button type="submit" form="profile-form" class="btn-primary text-sm">Salvar Alterações</button>
    </div>
  </div>
</div>

<!-- MODAL DE IMPORTAÇÃO (Genérico) -->
<div id="import-modal" class="modal-overlay">
  <div class="modal-content">
    <div class="modal-header">
      <h2 id="import-modal-title">Resultado da Importação</h2>
      <button class="btn-icon btn-close-modal">&times;</button>
    </div>
    <div class="modal-body">
      <div class="import-summary">
        <div class="summary-item success">
          <i class="ph ph-check-circle"></i>
          <div>
            <span id="import-sucesso">0</span>
            <p>Registros importados</p>
          </div>
        </div>
        <div class="summary-item error">
          <i class="ph ph-x-circle"></i>
          <div>
            <span id="import-falhas">0</span>
            <p>Registros com falha</p>
          </div>
        </div>
      </div>
      <div id="import-erros-container" style="display: none;">
        <strong>Detalhes dos Erros:</strong>
        <ul id="import-erros-lista" class="error-list"></ul>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-primary btn-close-modal text-sm">Fechar</button>
    </div>
  </div>
</div>


<template id="template-edit-items-modal">
  <div class="modal-overlay visible">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2>Editar Itens da Solicitação</h2>
        <button class="btn-icon btn-close-modal">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Formulário para adicionar um novo item -->
        <form id="form-add-item-modal" class="mb-6">
          <div class="filter-bar p-0 bg-transparent border-none">
            <div class="filter-group" style="flex-grow: 3;">
              <label for="modal-search-material-input">Adicionar Material*</label>
              <div class="searchable-select-container">
                <input type="text" id="modal-search-material-input" placeholder="Buscar pelo nome ou código..." autocomplete="off" required>
                <div id="modal-material-results-dropdown" class="searchable-results-list"></div>
              </div>
            </div>
            <div class="filter-group">
              <label for="modal-item-quantity">Quantidade*</label>
              <input type="number" id="modal-item-quantity" required min="0.01" step="any" class="text-right" placeholder="0.00">
            </div>
            <div class="filter-group">
              <label>&nbsp;</label>
              <button type="submit" class="btn btn-primary w-full"><i class="ph ph-plus"></i> Adicionar</button>
            </div>
          </div>
        </form>

        <!-- Tabela de itens atuais -->
        <h3 class="form-section-title mb-4">Itens Atuais</h3>
        <div class="table-container">
          <table class="data-table">
            <thead>
            <tr>
              <th>Material</th>
              <th>Qtd. Solicitada</th>
              <th class="w-16 text-right">Ações</th>
            </tr>
            </thead>
            <tbody id="modal-items-table-body"></tbody>
          </table>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-danger btn-close-modal">Cancelar</button>
        <button type="button" id="btn-save-item-changes" class="btn btn-primary">Salvar Alterações</button>
      </div>
    </div>
  </div>
</template>

<!-- CAMINHO CORRIGIDO PARA O SCRIPT PRINCIPAL -->
<script type="module" src="/assets/js/app.js"></script>
</body>
</html>